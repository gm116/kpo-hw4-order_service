# Система заказа билетов

## Описание проекта

Этот проект состоит из двух микросервисов, разработанных на основе RESTful API для системы заказов на покупку билетов. Первый микросервис реализует авторизацию пользователей, а второй — формирование заказов на покупку билетов авторизованными пользователями.

### Микросервис авторизации пользователей

Микросервис предоставляет следующие возможности:
- Регистрация нового пользователя
- Вход пользователя в систему (авторизация) с использованием JWT
- Проверка текущей сессии пользователя по токену

### Микросервис заказов на покупку билетов

Микросервис предоставляет следующие возможности:
- Создание нового заказа на покупку билета авторизованным пользователем
- Обработка заказов (изменение статуса с "check" на "success" или "rejection")
- Предоставление информации о заказе по его идентификатору

## Использованные технологии

- Kotlin
- Spring Boot
- Spring Data JPA
- H2 Database
- JWT (Json Web Token)
- Docker


### Запуск приложений

Для того чтобы запустить приложение, необходимо войти в директорию с микросервисом через терминал и вписать команду:
```bash
docker-compose up
```
Тогда в этом терминале запустится контейнер с микросервисом. Всего их два, поэтому нужно открыть два терминала.

## Примеры использования API через POSTMAN

### Регистрация нового пользователя

**Endpoint:** `localhost:8080/auth/register`

**Тело запроса:**

```json
{
  "nickname": "test",
  "email": "test@example.com",
  "password": "P@ssw0rd!"
}
```

### Вход пользователя

**Endpoint:** `localhost:8080/auth/login`

**Тело запроса:**

```json
{
  "email": "test@example.com",
  "password": "P@ssw0rd!"
}
```
**Ответ:**

```json
{
  "token": "jwt-token"
}
```

### Создание заказа

**Endpoint:** `localhost:8081/orders/create`

**Заголовки:**

`Authorization: Bearer jwt-token`

**Тело запроса:**

```json
{
  "userId": 1,
  "fromStationId": 1,
  "toStationId": 2
}
```

### Получение информации о заказе

**Endpoint:** `GET /order/{id}`

Этот эндпоинт используется для получения информации о конкретном заказе на покупку билета по его идентификатору.

**Пример запроса:**

```http
GET http://localhost:8081/order/1
```

**Заголовки:**

`Authorization: Bearer jwt-token`
### Получение информации о пользователе

**Endpoint:** `GET /user/info`

Этот эндпоинт используется для получения информации о текущем пользователе, основываясь на токене аутентификации.

**Пример запроса:**

```http
GET http://localhost:8080/user/info
```

**Заголовки:**

`Authorization: Bearer jwt-token`

## База данных

Для хранения данных в проекте используются две реляционные базы данных, реализованные на основе H2 Database.

### Микросервис авторизации

Содержит следующие таблицы:

- **`user`**: хранит информацию о пользователях, включая уникальный идентификатор, никнейм, электронную почту, хешированный пароль и дату регистрации.
- **`session`**: хранит информацию о сессиях пользователей, включая уникальный идентификатор, идентификатор пользователя, токен аутентификации и дату истечения срока действия сессии.

### Микросервис заказов

Содержит следующие таблицы:

- **`station`**: хранит информацию о станциях, включая уникальный идентификатор и название станции. **Я указал 4 станции с id 1, 2, 3, 4. Других станций нет**
- **`order`**: хранит информацию о заказах на покупку билетов, включая уникальный идентификатор, идентификатор пользователя, идентификаторы станций отправления и назначения, статус заказа и дату создания.
